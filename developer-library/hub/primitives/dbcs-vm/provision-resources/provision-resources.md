#Using Resource Manager to Provision Database Cloud Service

Resource Manager is an Oracle Cloud Infrastructure service that allows you to automate the process of provisioning your Oracle Cloud Infrastructure resources. Using Terraform, Resource Manager helps you install, configure, and manage resources through the "infrastructure-as-code" model.

In the following steps, you will provision a single instance DBCS on OCI using the Resource Manager.



## Prerequisites

Assuming you have already prepared the following:

- You have an OCI account with proper privileges.

- An SSH Key pair which provided by instructor or generated by yourself, using ssh-keygen(Linux, Mac) or putty-gen(Windows).

- A Terraform configuration (.zip) file which define the DBCS and related VCN.

- Collect your tenancy and compartment OCIDs in advance. you can check the following link for more details about OCID:

  https://docs.us-phoenix-1.oraclecloud.com/Content/General/Concepts/identifiers.htm#one



## Create a stack

1. Login to OCI Console. Open the navigation menu. Under **Solutions and Platform**, go to **Resource Manager** and click **Stacks**.![](./img/image-20200216155401032.png)

2. Choose the correct **Region** and a **Compartment** you have permission to work in.![image-20200216155456705](./img/image-20200216155456705.png)

3. Click **Create Stack**. 

   Select **My Configuration**, choose the **.ZIP FILE** button, click the **Browse** link and select the terraform configuration zip file that you downloaded earlier. Click **Select**.

	![](./img/zip-file.png)

4. Accept the default **Working Directory**. Give a name of the stack or accept the default name. Verify the **Compartment** is correct. Click **Next**.![image-20200216160354204](./img/image-20200216160354204.png)

5. The **Configure Variables** panel displays variables auto-populated from the Terraform file you uploaded. 

   - Copy and paste the **Tenenacy** and **Compartment** ocid you collect before.
   - Modify the **Region** you want the DBCS provision in, for example: *ap-seoul-1*. 
   - Copy and paste all the content in the SSH public key file.
   - Enter the administrator password of the database you will provision. For example: *Welcome_123#*
   - For the **Storage Management**: Enter **ASM** to use Oracle Automatic Storage Management (recommended for production workloads). Enter **LVM**  to quickly provision your DB system using Logical Volume Manager storage management software. It will take about 60 minutes if you choose **ASM** when provision the DBCS. If you choose **LVM**, it will take about 15 minutes.

   ![image-20200216161655760](./img/image-20200216161655760.png)

6. Click **Next** to Review the variables, and click **Create**.![image-20200216162457340](./img/image-20200216162457340.png)

7. The stack is created.![image-20200216162703922](./img/image-20200216162703922.png)



## Generate an Execution Plan

Running a plan job parses your Terraform configuration file and converts it into an execution plan listing resources and actions that will result when an apply job is run.

1. In the **Stack Details** page, go to **Terraform Actions** and select **Plan**.![image-20200216163309473](./img/image-20200216163309473.png)
2. In the **Plan** dialog page, accept the default values and click **Plan**.![image-20200216163414699](./img/image-20200216163414699.png)
3. In the **Job Details** page, You can see the new job created with an initial state of "Accepted." Soon the status changes to "In Progress."![image-20200216163638234](./img/image-20200216163638234.png)
4. When the job is complete, you can review the execution plan or download the logs![image-20200216164103522](./img/image-20200216164103522.png)



## Run an Apply Job

When you run an apply job for a stack, Terraform creates the resources and executes the actions defined in your Terraform configuration file. The time required to complete an apply job depends on the number and type of cloud resources to be created.

1. Back to the **Stack Details** page, go to **Terraform Actions** and select **Apply**.![image-20200216164540889](./img/image-20200216164540889.png)
2. In the apply dialog, accept the default value and click **Apply**
3. An new Job is created, in the Job Details page, You can see the job state is "Accepted." Soon the status changes to "In Progress."![image-20200216164826553](./img/image-20200216164826553.png)
4. Wait until the job state change to Succeeded. The DBCS has been provisioned now.![image-20200216172113272](./img/image-20200216172113272.png)


