{"paragraphs":[{"text":"%md \n\n#### In this notebook, we will describe how to build the following three machine learning models: \n\n- A generalized linear regression model to predict the best locations for opening new store branches based on demographic data across the US. To do this, we will first use the EXPLAIN procedure that identifies attributes that are important in explaining variation in values of a target column.\n- A generalized linear regression model to predict the sale quantity of each item in each store in the upcoming week by considering sales history over the past month.\n- A model to detect rare transactions using an unsupervised learning algorithm (1-Class Support Vector Machine).","user":"PHILIP","dateUpdated":"2020-03-31T16:18:59+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"md","editOnDblClick":false},"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>In this notebook, we will describe how to build the following three machine learning models:</h4>\n<ul>\n<li>A generalized linear regression model to predict the best locations for opening new store branches based on demographic data across the US. To do this, we will first use the EXPLAIN procedure that identifies attributes that are important in explaining variation in values of a target column.</li>\n<li>A generalized linear regression model to predict the sale quantity of each item in each store in the upcoming week by considering sales history over the past month.</li>\n<li>A model to detect rare transactions using an unsupervised learning algorithm (1-Class Support Vector Machine).</li>\n</ul>\n"}]},"jobName":"paragraph_1585671399951_332746653","id":"20200331-161639_1360192787","dateCreated":"2020-03-30T23:04:30+0000","dateStarted":"2020-03-31T16:18:56+0000","dateFinished":"2020-03-31T16:18:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":false,"focus":true,"$$hashKey":"object:146"},{"title":"Prepare Tables ","text":"%script\n-- If tables with identical names already exist, we will drop those tables first\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table transaction_values';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table item_store_sale_per_day';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table stores_zip_census';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n\n-- then, create three new tables based on the developer's transaction_history, us_census, and OOW_DEMO_stores tables\ncreate table transaction_values as \n            (select  transaction_id, sum(quantity*item_price) as total_txn_price, store_id, TO_CHAR(cast(date_of_sale as date), 'D') as day_of_week, date_of_sale\n                from developer.transaction_history group by transaction_id, store_id, date_of_sale);\nalter table transaction_values add id number(16,0);\nupdate transaction_values set id = rownum;\n\ncreate table item_store_sale_per_day as \n            (select product_id, store_id, sum(quantity) as sold_count, sum(quantity*item_price) as sold_value, EXTRACT(HOUR from date_of_sale) as hour_of_sale, date_of_sale as sale_date \n            from developer.transaction_history group by product_id, store_id, EXTRACT(HOUR from date_of_sale), date_of_sale);\nalter table item_store_sale_per_day add day_of_week char;\nupdate item_store_sale_per_day set day_of_week = TO_CHAR(cast(sale_date as date), 'D');\n\ncreate table stores_zip_census as \n            (select c.zip, c.state, c.county, sum(c.totalpop) as totalpop, sum(c.men) as men, sum(c.women) as women, round(avg(c.hispanic),2) as hispanic, round(avg(c.white),2) as white, round(avg(c.black),2) as black, round(avg(c.native),2) as native, round(avg(c.asian),2) as asian, round(avg(c.pacific),2) pacific, round(avg(c.income),2) as income, round(avg(c.incomeerr),2) as incomeerr, round(avg(c.incomepercap),2) incomepercap, round(avg(c.poverty),2) as poverty, round(avg(c.childpoverty),2) as childpoverty, sum(c.employed) as employed, round(avg(c.unemployment),2) as unemployment, round(avg(c.meancommute),2) as meancommute, round(avg(c.drive),2) as drive , round(avg(c.selfemployed),2) as selfemployed\n            from developer.us_census c inner join developer.OOW_DEMO_stores s on c.zip = s.store_zip \n            group by c.zip, c.state, c.county);\n","user":"TESTUSER3","dateUpdated":"2020-03-30T23:05:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","tableHide":false,"title":true,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399951_-189399985","id":"20200331-161639_2033222617","dateCreated":"2019-12-02T20:37:14+0000","dateStarted":"2020-02-26T16:50:31+0000","dateFinished":"2020-02-26T16:50:55+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:147"},{"title":"Create Tables for ML Models","text":"%script\n-- Drop the existing tables\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_item_store_sale';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_txn_sale';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n-- Create two new tables\ncreate table detailed_item_store_sale as \n     (select spd.product_id, spd.store_id, spd.sold_count, spd.sale_date, spd.hour_of_sale, spd.day_of_week, s.store_type, s.store_city, s.region_id, s.n1, s.n2, s.n3, s.n4, i.type, i.msrp, c.*\n        from item_store_sale_per_day spd \n            inner join developer.OOW_DEMO_stores s on spd.store_id = s.id \n            inner join developer.OOW_DEMO_items i on spd.product_id = i.id\n            inner join stores_zip_census c on s.store_zip = c.zip);\n            \n    \ncreate table detailed_txn_sale as \n     (select t.id, t.transaction_id, t.total_txn_price, t.day_of_week, s.store_type, s.store_city, s.region_id, c.totalpop as total_population, c.men as gender_male, c.unemployment, c.income, c.poverty, c.white as ethnicity_white, c.employed as employment\n        from transaction_values t \n            inner join developer.OOW_DEMO_stores s on t.store_id = s.id \n            inner join stores_zip_census c on s.store_zip = c.zip) ;\n            \n             \n","user":"TESTUSER3","dateUpdated":"2020-03-30T23:05:30+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"editorHide":false,"tableHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399951_-97013487","id":"20200331-161639_211002340","dateCreated":"2019-08-13T18:33:04+0000","dateStarted":"2020-02-26T16:50:57+0000","dateFinished":"2020-02-26T16:51:03+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:148"},{"title":"Attribute Importance Model","text":"The goal in the next section is to identify key attributes that have the most influence on a target attribute (Total Transaction Value). We build an Attribute Importance model (minimum desciption length algorithm) using the Sales History and Us_Census data all performed inside the Oracle Autonomous Data Warehouse Cloud (ADWC).","user":"TESTUSER3","dateUpdated":"2020-02-26T16:51:03+0000","config":{"colWidth":10,"enabled":false,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/osql","lineNumbers":false,"title":true,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399951_1219688956","id":"20200331-161639_1916851747","dateCreated":"2019-08-20T18:04:58+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"commited":false,"$$hashKey":"object:149"},{"title":"Build an Attribute Importance Model for Sales in Different Stores","text":"%script\n\n/*  Find the importance of attributes that independently impact the target attribute:   total_txn_price  */\n\n/* The EXPLAIN procedure creates a result table that lists the attributes in the order of their explanatory power. \ndata_table_name: Name of input table or view\nexplain_column_name: Name of the column to be explained \nresult_table_name: Name of the table where results are saved \n*/\n\nDECLARE\nv_sql varchar2(100);\n\nBEGIN\n\nBEGIN EXECUTE IMMEDIATE 'DROP TABLE txn_sale_ai_explain_output';\nEXCEPTION WHEN OTHERS THEN NULL; \nEND;\n\nBEGIN\n  DBMS_PREDICTIVE_ANALYTICS.EXPLAIN(\n    data_table_name     => 'detailed_txn_sale',\n    explain_column_name => 'total_txn_price',\n    result_table_name   => 'txn_sale_ai_explain_output');\nEND;\n\nEnd;","user":"TESTUSER3","dateUpdated":"2020-03-30T23:06:12+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"editorHide":false,"tableHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-1139573414","id":"20200331-161639_884772613","dateCreated":"2019-08-13T18:54:42+0000","dateStarted":"2020-02-26T16:51:05+0000","dateFinished":"2020-02-26T16:51:10+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:150"},{"title":"Best Store Location Prediction Model","text":"In the next section, we build a predictive model by using the top 5 most important attributes that influence total sales in each store to predict the best locations for opening new store branches based on the demographic data across the US. The model is a generalized linear regression model which is trained and applied inside the Oracle Autonomous Data Warehouse Cloud (ADWC).","user":"TESTUSER3","dateUpdated":"2020-03-31T16:20:01+0000","config":{"colWidth":10,"enabled":false,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/osql","lineNumbers":false,"title":true,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-794036443","id":"20200331-161639_1232071680","dateCreated":"2019-08-20T18:16:36+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"commited":false,"$$hashKey":"object:151"},{"title":"Create Tables for Store Location Prediction","text":"%script\n-- Drop Tables\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table total_txn_per_store';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table us_census_important_attributes';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table best_zip_training';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table zip_important_attributes';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n-- create new tables\ncreate table total_txn_per_store as (select sum(total_txn_price) as total_txn_value, store_id from transaction_values group by store_id);\n\ncreate table us_census_important_attributes as \n            (select c.zip, c.state, round(avg(c.unemployment),2) as unemployment, round(avg(c.white),2) as ETHNICITY_white, round(avg(c.income),2) as income, round(avg(c.poverty),2) as poverty, sum(c.men) as gender_male from developer.us_census c where c.zip is not null group by c.zip, c.state);\n            \ncreate table best_zip_training as \n            (select c.zip, c.unemployment, c.ETHNICITY_white, c.income, c.poverty, c.gender_male, t.total_txn_value\n             from developer.OOW_DEMO_stores s \n             inner join us_census_important_attributes c on s.store_zip = c.zip\n             inner join total_txn_per_store t on t.store_id = s.id);\n             \ncreate table zip_important_attributes as \n            (select c.zip, c.unemployment, c.ETHNICITY_white, c.income, c.poverty, c.gender_male from us_census_important_attributes c \n             where c.zip not in (select unique(s.store_zip) from developer.OOW_DEMO_stores s) and c.zip > 9999);\n\n","user":"TESTUSER3","dateUpdated":"2020-03-30T23:06:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","tableHide":false,"title":true,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-893444253","id":"20200331-161639_1492318794","dateCreated":"2019-08-16T17:55:20+0000","dateStarted":"2020-02-26T16:51:11+0000","dateFinished":"2020-02-26T16:51:14+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:152"},{"title":"Preparing GLM Model Feature Selection for Store Location Prediction","text":"%script\n\n/*  Clean up any previous GLM Models for notebook repeatability  */\nBEGIN\n  DBMS_DATA_MINING.DROP_MODEL('GLMR_location_prediction_Regr');\nEXCEPTION WHEN OTHERS THEN NULL; \nEND;\n/\n\n/*  Clean up and drop any previous GLM Model Settings table for notebook repeatability  */ \nBEGIN EXECUTE IMMEDIATE 'DROP TABLE GLMR_location_prediction_Regr_settings';\nEXCEPTION WHEN OTHERS THEN NULL; END;\n/\n\n/*  Clean up and drop any previous Model Diagnostics table for notebook repeatability  */ \nBEGIN EXECUTE IMMEDIATE 'DROP TABLE GLMR_location_prediction_Regr_diag';\nEXCEPTION WHEN OTHERS THEN NULL; END;\n/\n\n/* Create GLM Model Settings table */\nCREATE TABLE GLMR_location_prediction_Regr_settings (setting_name  VARCHAR2(30), setting_value VARCHAR2(4000));\n/\n\n \nBEGIN \n/* Populate settings table  */\n  INSERT INTO GLMR_location_prediction_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.algo_name, dbms_data_mining.algo_generalized_linear_model);\n  -- output row diagnostic statistics into a table named GLMC_SH_SAMPLE_DIAG  \n  INSERT INTO  GLMR_location_prediction_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.glms_diagnostics_table_name, 'GLMR_SH_SAMPLE_DIAG');  \n  INSERT INTO  GLMR_location_prediction_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.prep_auto, dbms_data_mining.prep_auto_on);  \nEND;","user":"TESTUSER3","dateUpdated":"2020-02-26T17:39:05+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_2075634143","id":"20200331-161639_754441913","dateCreated":"2019-08-20T01:38:58+0000","dateStarted":"2020-02-26T16:51:15+0000","dateFinished":"2020-02-26T16:51:15+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:153"},{"title":"Build the Store Prediction Model","text":"%script\n\n/* TRANSFORM_LIST is a list of transformations that can be embedded in a model.\ncase_id_column_name: case identifier column \ntarget_column_name: target column containg the known target values */ \n\ndeclare\n  v_xlst dbms_data_mining_transform.TRANSFORM_LIST;\n \nBEGIN\n  DBMS_DATA_MINING.CREATE_MODEL(\n    model_name          => 'GLMR_location_prediction_Regr',\n    mining_function     => dbms_data_mining.regression,\n    data_table_name     => 'best_zip_training',\n    case_id_column_name => 'zip',\n    target_column_name  => 'total_txn_value',\n    settings_table_name => 'GLMR_location_prediction_Regr_settings',\n    xform_list          => v_xlst);\nEND;","user":"TESTUSER3","dateUpdated":"2020-03-30T23:06:48+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-1529068454","id":"20200331-161639_2095298693","dateCreated":"2019-08-20T01:41:54+0000","dateStarted":"2020-02-26T16:51:16+0000","dateFinished":"2020-02-26T16:51:17+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:154"},{"title":"Prediction (Store Location Model)","text":"%script\n/* Drop the prediction result table*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table txn_value_prediction';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table best_store_locations';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.top_ten_store_locations';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* create the prediction result table*/\nCREATE TABLE txn_value_prediction\n( zip number,\n  PREDICTED_txn_value NUMBER\n);\n\n/* apply the ML model on the prediction set, store the data in the prediction result table*/\nInsert into txn_value_prediction (zip, PREDICTED_txn_value)\n        select zip, PREDICTION(GLMR_location_prediction_Regr USING *) pr \n        from zip_important_attributes;\n        \ncreate table best_store_locations as \n        (select rank() over (order by t.PREDICTED_txn_value desc) rank, c.state, t.* from txn_value_prediction t join us_census_important_attributes c on t.zip = c.zip);\n        \ncreate table developer.top_ten_store_locations as \n        (select * from best_store_locations where rank < 11);\n        ","user":"TESTUSER3","dateUpdated":"2020-02-26T17:39:15+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-494370913","id":"20200331-161639_1247429877","dateCreated":"2019-08-20T01:43:46+0000","dateStarted":"2020-02-26T16:51:22+0000","dateFinished":"2020-02-26T16:51:24+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:155"},{"title":"Item Sale Prediction Model","text":"In the next section, we build a model to predict the sale quantity of each item in each store in the upcoming week by considering the sales history over the past month. The model is a generalized linear regression model which is trained and applied inside the Oracle Autonomous Data Warehouse Cloud (ADWC).","user":"TESTUSER3","dateUpdated":"2020-03-31T16:20:48+0000","config":{"colWidth":10,"enabled":false,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/osql","lineNumbers":false,"title":true,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_427358859","id":"20200331-161639_87410526","dateCreated":"2019-08-20T18:22:23+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"commited":false,"$$hashKey":"object:156"},{"title":"Create Training and Test Sets for Item Sale Prediction ","text":"%script\n/* Drop exisiting tables*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_item_store_sale_train';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_item_store_sale_test';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_item_store_sale_predict';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* Divide the datset to traing and test sets (80-20)*/\ncreate table detailed_item_store_sale_train as (select * from detailed_item_store_sale where to_date(to_char(sale_date, 'YYYY-MM-DD'), 'YYYY-MM-DD') < to_date('2019-07-31', 'YYYY-MM-DD'));\ncreate table detailed_item_store_sale_test as (select * from detailed_item_store_sale where to_date(to_char(sale_date, 'YYYY-MM-DD'), 'YYYY-MM-DD') > to_date('2019-07-30', 'YYYY-MM-DD'));\n\ncreate table detailed_item_store_sale_predict as (select * from detailed_item_store_sale_test);\nalter table detailed_item_store_sale_predict drop column sold_count;\nupdate detailed_item_store_sale_predict set sale_date = sale_date+32;\n\n","user":"TESTUSER3","dateUpdated":"2020-02-26T17:39:23+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_423259139","id":"20200331-161639_396743511","dateCreated":"2019-08-15T17:05:55+0000","dateStarted":"2020-02-26T16:51:28+0000","dateFinished":"2020-02-26T16:51:40+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:157"},{"title":"Preparing GLM Model Feature Selection for Item Sale Prediction","text":"%script\n\n/*  Clean up any previous GLM Models for notebook repeatability  */\nBEGIN\n  DBMS_DATA_MINING.DROP_MODEL('GLMR_soldItem_Regr');\nEXCEPTION WHEN OTHERS THEN NULL; \nEND;\n/\n\n/*  Clean up and drop any previous GLM Model Settings table for notebook repeatability  */ \nBEGIN EXECUTE IMMEDIATE 'DROP TABLE GLMR_soldItem_Regr_settings';\nEXCEPTION WHEN OTHERS THEN NULL; END;\n/\n\n/*  Clean up and drop any previous Model Diagnostics table for notebook repeatability  */ \nBEGIN EXECUTE IMMEDIATE 'DROP TABLE GLMR_soldItem_Regr_diag';\nEXCEPTION WHEN OTHERS THEN NULL; END;\n/\n\n/* Create GLM Model Settings table */\nCREATE TABLE GLMR_soldItem_Regr_settings (setting_name  VARCHAR2(30), setting_value VARCHAR2(4000));\n/\n\n \nBEGIN \n/* Populate settings table  */\n  INSERT INTO GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.algo_name, dbms_data_mining.algo_generalized_linear_model);\n  -- output row diagnostic statistics into a table named GLMC_SH_SAMPLE_DIAG  \n  INSERT INTO  GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.glms_diagnostics_table_name, 'GLMR_SH_SAMPLE_DIAG');  \n  INSERT INTO  GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.prep_auto, dbms_data_mining.prep_auto_on);  \n  -- turn on feature selection\n  INSERT INTO  GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES  \n    (dbms_data_mining.glms_ftr_selection, \n    dbms_data_mining.glms_ftr_selection_enable);\n  -- turn on feature generation\n  INSERT INTO  GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES \n    (dbms_data_mining.glms_ftr_generation, \n    dbms_data_mining.glms_ftr_generation_enable); \nEND;","user":"TESTUSER3","dateUpdated":"2020-02-26T17:39:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-1553610426","id":"20200331-161639_1986229942","dateCreated":"2019-08-14T18:55:33+0000","dateStarted":"2020-02-26T16:51:41+0000","dateFinished":"2020-02-26T16:51:41+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:158"},{"title":"Build the GLM Regression Model for Item Sale Prediction","text":"%script\n\ndeclare\n  v_xlst dbms_data_mining_transform.TRANSFORM_LIST;\n \nBEGIN\n  DBMS_DATA_MINING.CREATE_MODEL(\n    model_name          => 'GLMR_soldItem_Regr',\n    mining_function     => dbms_data_mining.regression,\n    data_table_name     => 'detailed_item_store_sale_train',\n    case_id_column_name => 'sale_date',\n    target_column_name  => 'sold_count',\n    settings_table_name => 'GLMR_soldItem_Regr_settings',\n    xform_list          => v_xlst);\nEND;","user":"TESTUSER3","dateUpdated":"2020-02-26T17:39:32+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_1164734494","id":"20200331-161639_1854335331","dateCreated":"2019-08-14T19:53:26+0000","dateStarted":"2020-02-26T16:51:42+0000","dateFinished":"2020-02-26T17:00:23+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:159"},{"title":"Validation (Item Sale Prediction Model)","text":"%script\n/* Drop the validation result table*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table Item_sold_validation';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* create the validation result table*/\nCREATE TABLE Item_sold_validation\n( sale_date TIMESTAMP,\n  store_id NUMBER,\n  product_id NUMBER,\n  hour_of_sale NUMBER,\n  ACTUAL_sold_count NUMBER,\n  PREDICTED_sold_count NUMBER\n);\n\n/* apply the ML model on the test set for validation, store the data in the validation result table*/\nInsert into Item_sold_validation (sale_date, store_id, product_id, hour_of_sale, ACTUAL_sold_count, PREDICTED_sold_count)\n        select sale_date, store_id, product_id, hour_of_sale, sold_count, PREDICTION(GLMR_soldItem_Regr USING *) pr \n        from detailed_item_store_sale_test;","user":"TESTUSER3","dateUpdated":"2020-02-26T17:39:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_1289777429","id":"20200331-161639_1159908570","dateCreated":"2019-08-15T17:25:54+0000","dateStarted":"2020-02-26T17:00:23+0000","dateFinished":"2020-02-26T17:00:24+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:160"},{"title":"Prediction (Item Sale Prediction Model)","text":"%script\n/* Drop the prediction result table*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table Item_sold_prediction';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table Item_sold_prediction_next_week';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* create the prediction result table*/\nCREATE TABLE Item_sold_prediction\n( sale_date TIMESTAMP,\n  store_id NUMBER,\n  product_id NUMBER,\n  hour_of_sale NUMBER,\n  PREDICTED_sold_count NUMBER\n);\n\n\n/* apply the ML model on the prediction set, store the data in the prediction result table*/\nInsert into Item_sold_prediction (sale_date, store_id, product_id, hour_of_sale, PREDICTED_sold_count)\n        select sale_date, store_id, product_id, hour_of_sale, PREDICTION(GLMR_soldItem_Regr USING *) pr \n        from detailed_item_store_sale_predict;\n        \ncreate table Item_sold_prediction_next_week as (select sum(PREDICTED_sold_count) as sale_prediction, store_id, product_id from Item_sold_prediction group by store_id, product_id);","user":"TESTUSER3","dateUpdated":"2020-02-26T17:39:42+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_872295417","id":"20200331-161639_2091159618","dateCreated":"2019-08-15T21:48:14+0000","dateStarted":"2020-02-26T17:00:25+0000","dateFinished":"2020-02-26T17:00:26+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:161"},{"title":"Transfer Result Tables to the Developer's Schema for Visualization","text":"%script\n/* Drop exisiting tables in the Developer's space*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.Item_sold_validation';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.Item_sold_prediction';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.Item_sold_prediction_next_week';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n\n/* copy ML result tables to Developer's space*/\ncreate table developer.Item_sold_validation as (select * from Item_sold_validation);\ncreate table developer.Item_sold_prediction as (select * from Item_sold_prediction);\ncreate table developer.Item_sold_prediction_next_week as (select * from Item_sold_prediction_next_week);\n","user":"TESTUSER3","dateUpdated":"2020-02-26T17:39:47+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-1335162666","id":"20200331-161639_287285158","dateCreated":"2019-08-12T19:37:20+0000","dateStarted":"2020-02-26T17:00:26+0000","dateFinished":"2020-02-26T17:00:28+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:162"},{"title":"Anomaly Detection to Find Suspicious Transactions","text":"The next section shows how to detect rare transactions using an unsupervised learning algorithm (1-Class Support Vector Machine). The notebook first builds a 1-Class SVM model and then applies the model to flag unusual or suspicious transactions. The anomaly detection model can also be applied to detect new suspicious transactions. The entire machine learning methodology runs inside the Oracle Autonomous Data Warehouse Cloud (ADWC).\n","user":"TESTUSER3","dateUpdated":"2020-02-26T17:00:28+0000","config":{"colWidth":9,"enabled":false,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/osql","title":true,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_2010875946","id":"20200331-161639_1208725783","dateCreated":"2019-08-20T18:39:48+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"commited":false,"$$hashKey":"object:163"},{"title":"Build Anomaly Detection Model (1-Class SVM)","text":"%script\n\n/*  Build Anomaly Detection Model (1-Class SVM) on detailed_txn_sale data  */\n\nDECLARE\nv_sql varchar2(100);\n\nBEGIN\n\n/*  drop build settings  */\nBEGIN\nv_sql := 'DROP TABLE detailed_txn_sale_SET';\nEXECUTE IMMEDIATE v_sql;\nDBMS_OUTPUT.PUT_LINE (v_sql ||': succeeded');\nEXCEPTION\nWHEN OTHERS THEN\nDBMS_OUTPUT.PUT_LINE (v_sql ||': drop unneccessary - no table exists');\nEND;\n\n/*  drop any previous model.  */\nBEGIN\nv_sql := 'CALL DBMS_DATA_MINING.DROP_MODEL(''detailed_txn_sale_MODEL'')';\nEXECUTE IMMEDIATE v_sql;\nDBMS_OUTPUT.PUT_LINE (v_sql ||': succeeded');\nEXCEPTION\nWHEN OTHERS THEN\nDBMS_OUTPUT.PUT_LINE (v_sql ||': drop unneccessary - no model exists');\nEND;\n\n\n/*  Create a Build Setting table for Model Build  */\n\nEXECUTE IMMEDIATE 'CREATE TABLE detailed_txn_sale_SET (setting_name VARCHAR2(30),setting_value VARCHAR2(4000))';\nEXECUTE IMMEDIATE 'INSERT INTO detailed_txn_sale_SET (setting_name, setting_value) VALUES (''ALGO_NAME'', ''ALGO_SUPPORT_VECTOR_MACHINES'')';\nEXECUTE IMMEDIATE 'INSERT INTO detailed_txn_sale_SET (setting_name, setting_value) VALUES (''PREP_AUTO'', ''ON'')';\nDBMS_OUTPUT.PUT_LINE ('Created model build settings table: detailed_txn_sale_SET ');\n\n\n/*  Build the 1-Class SVM model.  */\n\nEXECUTE IMMEDIATE 'CALL DBMS_DATA_MINING.CREATE_MODEL(''detailed_txn_sale_MODEL'', ''CLASSIFICATION'', ''detailed_txn_sale'', ''transaction_id'', null, ''detailed_txn_sale_SET'')';\nDBMS_OUTPUT.PUT_LINE ('Created model: detailed_txn_sale_MODEL');\n\nEnd;\n\n","user":"TESTUSER3","dateUpdated":"2020-02-26T17:39:57+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-480914568","id":"20200331-161639_454877392","dateCreated":"2019-08-13T19:29:59+0000","dateStarted":"2020-02-26T17:00:28+0000","dateFinished":"2020-02-26T17:00:33+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:164"},{"title":"Calculate the Probability of Transactions Being Anomalous","text":"%script\n/* drop the result table */\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table anomalous_transactions';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* create the result table*/ \ncreate table anomalous_transactions as \n(select id, transaction_id, total_txn_price, round(prob_fraud*100,2) percent_fraud,\n      rank() over (order by prob_fraud desc) rnk from\n(select id, transaction_id, total_txn_price, prediction_probability(detailed_txn_sale_MODEL, '0' using *) prob_fraud\nfrom detailed_txn_sale\n));\n","user":"TESTUSER3","dateUpdated":"2020-02-26T17:40:01+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-371115088","id":"20200331-161639_1138902385","dateCreated":"2019-08-20T00:56:24+0000","dateStarted":"2020-02-26T17:00:34+0000","dateFinished":"2020-02-26T17:00:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:165"},{"title":"Display the Top 3 Transactions in Probability of Being Anomalous in Descending Order","text":"%sql\nSELECT at.rnk, at.id, at.transaction_id, tv.store_id, tv.date_of_sale, at.total_txn_price, at.percent_fraud FROM anomalous_transactions at join transaction_values tv on at.id = tv.id where at.rnk <= 3 order by at.percent_fraud desc;\n","user":"TESTUSER3","dateUpdated":"2020-02-26T17:40:07+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"RNK":"string","ID":"string","TRANSACTION_ID":"string","STORE_ID":"string","DATE_OF_SALE":"string","TOTAL_TXN_PRICE":"string","PERCENT_FRAUD":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/osql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_2007843683","id":"20200331-161639_778899460","dateCreated":"2019-08-20T18:02:23+0000","dateStarted":"2020-02-26T17:00:38+0000","dateFinished":"2020-02-26T17:00:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:166"},{"title":"Transfer Result Tables to the Developer's Schema","text":"%script\n/* Drop exisiting tables in the Developer's space*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.anomalous_transactions';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* copy ML result tables to Developer's space*/\ncreate table developer.anomalous_transactions as (SELECT t.rnk, t.id, t.transaction_id, tv.store_id, tv.date_of_sale, t.total_txn_price, t.percent_fraud FROM anomalous_transactions t join transaction_values tv on t.id = tv.id where t.rnk <= 3);\n","user":"TESTUSER3","dateUpdated":"2020-02-26T17:05:02+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","title":true,"tableHide":false,"editorHide":false,"fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_1089352306","id":"20200331-161639_1006342103","dateCreated":"2019-08-20T18:13:47+0000","dateStarted":"2020-02-26T17:00:39+0000","dateFinished":"2020-02-26T17:00:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:167"},{"text":"%script\n","user":"TESTUSER3","dateUpdated":"2020-02-26T17:00:40+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"plsql","editOnDblClick":false},"editorMode":"ace/mode/plsql","fontSize":9},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1585671399952_-991462445","id":"20200331-161639_1193140760","dateCreated":"2019-12-16T18:10:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:168"}],"name":"ML Prediction Models","id":"635705","noteParams":{},"noteForms":{},"angularObjects":{"ORA962C7772C9:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}